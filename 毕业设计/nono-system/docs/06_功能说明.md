# 系统功能说明

## 1. 设备统计和仪表板

### API端点

```
GET /api/v1/statistics
```

### 响应示例

```json
{
  "devices": {
    "total": 100,
    "active": 80,
    "revoked": 15,
    "suspicious": 5
  },
  "domains": {
    "total": 5,
    "details": [...]
  },
  "authentication": {
    "total": 1000,
    "successful": 950,
    "failed": 50,
    "on_chain": 800,
    "success_rate": 95.0,
    "on_chain_rate": 80.0
  }
}
```

## 2. 设备操作历史记录

### API端点

```
GET /api/v1/devices/:did/history
```

### 查询参数

- `page`: 页码（默认：1）
- `page_size`: 每页数量（默认：20）

### 响应示例

```json
{
  "device_did": "1234124",
  "history": [
    {
      "id": 1,
      "action": "register",
      "old_value": "null",
      "new_value": "{\"did\":\"1234124\",\"status\":\"active\"}",
      "changed_by": "system",
      "tx_hash": "",
      "description": "设备注册",
      "created_at": "2025-01-02T10:30:00Z"
    }
  ],
  "total": 1
}
```

## 3. 批量操作功能

### 3.1 批量注册设备

**API端点**：`POST /api/v1/devices/batch`

**请求体**：
```json
{
  "devices": [
    {
      "did": "did:example:device1",
      "device_id": "device001",
      "device_type": "sensor",
      "domain": "设备",
      "metadata": "{}"
    }
  ]
}
```

**响应示例**：
```json
{
  "total": 1,
  "success": 1,
  "failed": 0,
  "results": [...]
}
```

### 3.2 批量更新设备状态

**API端点**：`PUT /api/v1/devices/batch/status`

**请求体**：
```json
{
  "devices": [
    {"did": "1234124", "status": "suspicious"},
    {"did": "4654546", "status": "active"}
  ]
}
```

## 4. 高级搜索和过滤

### API端点

```
GET /api/v1/devices/search
```

### 查询参数

- `did`: DID模糊搜索
- `device_id`: 设备ID模糊搜索
- `device_type`: 设备类型精确匹配
- `manufacturer`: 制造商模糊搜索
- `domain`: 域精确匹配
- `status`: 状态精确匹配
- `statuses`: 多状态搜索（逗号分隔，如：`active,suspicious`）
- `start_date`: 注册开始日期（格式：YYYY-MM-DD）
- `end_date`: 注册结束日期（格式：YYYY-MM-DD）
- `sort_by`: 排序字段（默认：`created_at`）
- `sort_order`: 排序顺序（`asc`或`desc`，默认：`desc`）
- `page`: 页码（默认：1）
- `page_size`: 每页数量（默认：20）

### 使用示例

```bash
# 按状态和域搜索
curl "http://localhost:8080/api/v1/devices/search?status=active&domain=设备"

# 多状态搜索
curl "http://localhost:8080/api/v1/devices/search?statuses=active,suspicious"

# 时间范围搜索
curl "http://localhost:8080/api/v1/devices/search?start_date=2025-01-01&end_date=2025-01-31"
```

## 5. 数据导出功能

### 5.1 导出设备数据

**API端点**：`GET /api/v1/export/devices`

**查询参数**：
- `domain`: 按域过滤（可选）
- `status`: 按状态过滤（可选）

**使用示例**：
```bash
# 导出所有设备
curl http://localhost:8080/api/v1/export/devices -o devices.csv

# 导出特定域的设备
curl "http://localhost:8080/api/v1/export/devices?domain=设备" -o devices_domain.csv
```

### 5.2 导出认证记录

**API端点**：`GET /api/v1/export/auth-records`

**查询参数**：
- `device_did`: 按设备DID过滤（可选）

**使用示例**：
```bash
# 导出所有认证记录
curl http://localhost:8080/api/v1/export/auth-records -o auth_records.csv
```

## 功能使用建议

### 1. 仪表板集成

使用统计API构建系统仪表板，实时展示系统运行状态。

### 2. 批量导入

使用批量注册功能，从Excel或其他系统导入设备数据。

### 3. 审计追踪

使用设备历史记录功能，追踪设备的所有变更操作，满足审计要求。

### 4. 数据分析

使用导出功能，将数据导出到Excel或其他分析工具进行深入分析。

### 5. 灵活查询

使用高级搜索功能，快速定位特定条件的设备。

## 注意事项

1. **批量操作限制**：每次批量操作最多100条记录
2. **导出文件大小**：大量数据导出时，注意文件大小和网络传输时间
3. **历史记录**：设备历史记录会自动记录所有操作，无需手动调用
4. **搜索性能**：复杂搜索条件可能影响查询性能，建议添加适当的索引

## 下一步

- 查看 [跨域认证流程](05_跨域认证流程.md) 了解系统核心功能
- 查看 [权限管理](04_权限管理.md) 了解用户权限系统
